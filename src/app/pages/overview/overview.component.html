<main>
  <div class="wrapper" *ngIf="this.expenses.length; else empty">
    <section class="header">
      <!-- contains some control buttons and text-->
      <section class="filters" *ngIf="totalEntries">
        <app-filter (filterChange)="onFilterChange($event)" [totalEntries]="totalEntries"></app-filter>
      </section>
    </section>
    <div class="container">
      <section class="list" *ngIf="innerWidth < 1400; else table">
        <!-- container for the list of expenses with each row being an expense -->
        <app-expense
          *ngFor="let expense of expenses; let j = index"
          [expense]="expense"
          (addReceipt)="onAddReceipt(j, $event)"
          (addComment)="onAddComment(j, $event)"
        ></app-expense>
      </section>
      <ng-template #table>
        <section class="table__container">
          <div class="table">
            <div class="table__header">
              <div class="table__header__section" *ngFor="let column of tableColumns">
                <div *ngIf="column.name" class="table__header__cell" [ngStyle]="{ 'min-width': column.width + 'px' }">
                  <p>{{ column.name }}</p>
                </div>
              </div>
            </div>
            <div class="table__body">
              <div class="table__row" *ngFor="let row of expenses; let i = index">
                <div class="table__row__section" [ngStyle]="{ 'min-width': tableColumns[0].width + 'px' }">
                  <span>{{ row.user.first }}</span>
                </div>

                <div class="table__row__section" [ngStyle]="{ 'min-width': tableColumns[1].width + 'px' }">
                  <span>{{ row.user.last }}</span>
                </div>

                <div class="table__row__section" [ngStyle]="{ 'min-width': tableColumns[2].width + 'px' }">
                  <span>{{ row.date | date: 'dd-MM-y' }}</span>
                </div>

                <div class="table__row__section" [ngStyle]="{ 'min-width': tableColumns[3].width + 'px' }">
                  <span>{{ row.amount.value }}</span>
                </div>

                <div class="table__row__section" [ngStyle]="{ 'min-width': tableColumns[4].width + 'px' }">
                  <span>{{ row.amount.currency }}</span>
                </div>

                <div class="table__row__section" [ngStyle]="{ 'min-width': tableColumns[5].width + 'px' }">
                  <span>{{ row.merchant }}</span>
                </div>

                <div class="table__row__section" [ngStyle]="{ 'min-width': tableColumns[6].width + 'px' }">
                  <div class="receipts__wrapper">
                    <app-thumbnail
                      *ngFor="let receipt of row.receipts"
                      [src]="receipt.url"
                      [isSmall]="true"
                    ></app-thumbnail>
                  </div>
                </div>

                <div
                  matTooltip="{{ row.comment }}"
                  class="table__row__section"
                  [ngStyle]="{ 'min-width': tableColumns[7].width + 'px' }"
                >
                  <span>{{ row.comment }}</span>
                </div>

                <div class="table__row__section" [ngStyle]="{ 'min-width': tableColumns[8].width + 'px' }">
                  <span>{{ row.category }}</span>
                </div>

                <div class="table__row__section center" [ngStyle]="{ 'min-width': tableColumns[9].width + 'px' }">
                  <a (click)="onAddReceipt(i)" class="pointer"><i class="material-icons">add_photo_alternate</i></a>
                </div>

                <div class="table__row__section center" [ngStyle]="{ 'min-width': tableColumns[10].width + 'px' }">
                  <a (click)="onAddComment(i)" class="pointer"><i class="material-icons">add_comment</i></a>
                </div>
              </div>
            </div>
          </div>
        </section>
      </ng-template>
    </div>
    <app-pagination
      *ngIf="nrOfPages.amount"
      [nrOfPages]="nrOfPages"
      (pageChange)="onPageChange($event)"
    ></app-pagination>
  </div>
  <ng-template #empty>
    <div class="wrapper empty">
      <h1>There are no expenses, yet.</h1>
      <mat-spinner [diameter]="40"></mat-spinner>
    </div>
  </ng-template>
</main>
